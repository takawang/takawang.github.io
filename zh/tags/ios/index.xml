<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>iOS on Liberation Notes</title>
    <link>https://blog2.cmwang.net/zh/tags/ios/</link>
    <description>Recent content in iOS on Liberation Notes</description>
    <image>
      <title>Liberation Notes</title>
      <url>https://blog2.cmwang.net/47</url>
      <link>https://blog2.cmwang.net/47</link>
    </image>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh</language>
    <lastBuildDate>Sat, 06 Aug 2022 11:04:15 +0000</lastBuildDate>
    <atom:link href="https://blog2.cmwang.net/zh/tags/ios/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>é€é CoreML åœ¨ iOS ä¸Šå¯¦ç¾å³æ™‚çš„ç‰©é«”åµæ¸¬</title>
      <link>https://blog2.cmwang.net/zh/posts/2022/08/execute-yolov7-model-on-ios-devices/</link>
      <pubDate>Sat, 06 Aug 2022 11:04:15 +0000</pubDate>
      <guid>https://blog2.cmwang.net/zh/posts/2022/08/execute-yolov7-model-on-ios-devices/</guid>
      <description>é€™ç¯‡æ–‡ç« åªæœ‰è‹±æ–‡ç‰ˆçš„</description>
      <content:encoded><![CDATA[<p><img loading="lazy" src="images/1.jpeg" alt="image"  />

Real-time object detection with CoreML is trickier than you think.</p>
<p>Usually, you have two choices to build a machine learning app for your mobile device, <strong>inference</strong> can happen either directly on-device or on cloud-based servers. It all depends on your usage scenario, there is no one-size fit all solution. In this article, we will only focus on on-device inference.</p>
<p>At WWDC 2017 Apple released first Core ML. Core ML is Appleâ€™s machine learning framework for doing on-device inference. Core ML is not the only way to do on-device inference, there are tens of libraries and frameworks that are compatible with iOS, but thatâ€™s beyond the scope of this article. From the <a href="https://github.com/WongKinYiu/yolov7">YOLOv7 official repository</a>, we can get the <a href="https://github.com/WongKinYiu/yolov7/blob/main/export.py">export script</a> to convert trained PyTorch model to Core ML format effortlessly. However, keep one thing in mind, YOLOv7 is a popular open source project, new changes and updates are added very quickly. Iâ€™m also very glad to send a <a href="https://github.com/WongKinYiu/yolov7/pull/434/commits">PR</a> to improve the export script last night due to this writing ğŸ˜ƒ.After you got the exported Core ML models, no kidding, you have tons of things in your todo list. <a href="https://twitter.com/mhollemans">Matthijs Hollemans</a> has already written an insightful <a href="https://machinethink.net/blog/bounding-boxes/">article</a> in his blog, be sure to checkout and <a href="https://leanpub.com/coreml-survival-guide">support his efforts</a>! Here is my short list:</p>
<ul>
<li>Configure your Core ML model in a particular way. You can either append NMS to your model or write a lot of additional Swift code. IMHO, this is the most difficult part if you know nothing about the object detection model.</li>
<li>Specify camera resolution, donâ€™t simply select the highest resolution available if your app doesnâ€™t require it.</li>
<li>Resize or crop your input image to fit network input dimension, it depends on your application.</li>
<li>Feed modified images to your model in a correct orientation.</li>
<li>Fix Visionâ€™s weird orin.</li>
<li>Convert bounding boxes coordinate system for display. This is also a trickier part, you need some iOS development experiences and a pencil for calculation ğŸ˜.</li>
</ul>
<p>According to Hollemansâ€™s article, there are at least 5 different coordinate systems you need to take care, not to mention how to handle real-time capturing correctly and efficiently is also non-trivial. You can follow these two articles to learn how to create a custom camera view.</p>
<p><a href="https://developer.apple.com/documentation/vision/recognizing_objects_in_live_capture">Apple Developer Documentation | Recognizing Objects in Live Capture</a></p>
<p><a href="https://guides.codepath.com/ios/Creating-a-Custom-Camera-View">Creating a Custom Camera View | CodePath iOS Cliffnotes</a>
At the latest <a href="https://developer.apple.com/videos/play/wwdc2022/10027/">WWDC 2022</a>, Apple introduced even more performance tools to its CoreML toolchain, now you can check your modelâ€™s metadata via <strong>performance reports</strong> and <strong>Core ML Instrument</strong> without writing any code. You can also use <code>computeUnits = .cpuAndNeuralEngine</code> if you donâ€™t want to use the GPU but always force the model to run on the CPU and ANE if available.</p>
<p><img loading="lazy" src="images/2.png#layoutTextWidth" alt="image"  />

Prefer CPU and ANE instead of GPU.</p>
<p>You can learn more about ANE from the following repository, thank you again Hollemans.</p>
<p><a href="https://github.com/hollance/neural-engine">GitHub - hollance/neural-engine: Everything we actually know about the Apple Neural Engine (ANE)</a></p>
<p>Here are snapshots from my modelâ€™s performance reports.</p>
<p><img loading="lazy" src="images/3.png#layoutTextWidth" alt="image"  />

You can evaluate your model via drag-and-drop image files.</p>
<p>There is no significant inference speed differences among quantization models, but the model size only about half the size. Itâ€™s a good thing for your mobile applications.
<img loading="lazy" src="images/4.png#layoutTextWidth" alt="image"  />
</p>
<p><img loading="lazy" src="images/5.png#layoutTextWidth" alt="image"  />

No inference speed improved. (Left is FP32, right is FP16)</p>
<p><img loading="lazy" src="images/6.png#layoutTextWidth" alt="image"  />
</p>
<p><img loading="lazy" src="images/7.png#layoutTextWidth" alt="image"  />

Half the size of the FP32 model.</p>
<p>Finally, you have a working YOLOv7 Core ML model on the iOS devices, be careful of the heatğŸ”¥. Happy coding!</p>
<p><img loading="lazy" src="images/8.gif#layoutTextWidth" alt="image"  />

<strong>Yolov7-tiny on iPad Mini 6.</strong> Copyrights of <a href="https://youtu.be/hngml3y2Rq8">BBIBBI Dance Practice</a> belongs Kakao Entertainment.</p>
<h3 id="references">References</h3>
<ul>
<li><a href="https://developer.apple.com/documentation/vision/recognizing_objects_in_live_capture">Recognizing Objects in Live Capture</a></li>
<li><a href="https://machinethink.net/blog/bounding-boxes/">How to display Vision bounding boxes</a></li>
<li><a href="https://guides.codepath.com/ios/Creating-a-Custom-Camera-View">Creating a Custom Camera View</a></li>
<li><a href="https://github.com/hollance/neural-engine">The Neural Engineâ€Šâ€”â€Šwhat do we know about it?</a></li>
<li><a href="https://github.com/WongKinYiu/yolov7">WongKinYiu/yolov7</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2022/10027/">WWDC2022â€Šâ€”â€ŠOptimize your Core ML usage</a></li>
<li><a href="https://machinethink.net/blog/mobilenet-ssdlite-coreml/">MobileNetV2 + SSDLite with Core ML</a></li>
<li><a href="https://github.com/dbsystel/yolov5-coreml-tools">yolov5â€Šâ€”â€ŠCoreML Tools</a></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>æ¨¡æ“¬å¥§é‹äº”ç’°ç„¡äººæ©Ÿç‡ˆå…‰ç§€</title>
      <link>https://blog2.cmwang.net/zh/posts/2022/03/simulated-olympic-rings-drone-light-show/</link>
      <pubDate>Sat, 19 Mar 2022 12:37:27 +0000</pubDate>
      <guid>https://blog2.cmwang.net/zh/posts/2022/03/simulated-olympic-rings-drone-light-show/</guid>
      <description>ç·´ç¿’ CALayer &amp;amp; Gesture Recognizer@</description>
      <content:encoded><![CDATA[<p><strong>å­¸ç¿’ç›®æ¨™ï¼š</strong></p>
<ul>
<li>Gesture Recognizer</li>
<li>CALayer &amp; UIBezierPath</li>
<li>Class &amp; Function</li>
</ul>
<p><strong>ç·´ç¿’æˆæœï¼š</strong></p>
<p><img loading="lazy" src="images/1.gif" alt="image"  />
</p>
<p><strong>åŸå§‹ç¢¼ï¼š</strong></p>
<p><a href="https://github.com/takawang/olympic-drone">GitHub - takawang/olympic-drone</a></p>
<p><strong>ç·£èµ·ï¼š</strong></p>
<p>é€™æ¬¡çš„ç·´ç¿’ï¼Œä¸»è¦æ˜¯çœ‹åˆ°ä¸‹é¢é€™ç¯‡æ–‡ç« çš„å•Ÿç™¼ï¼Œä¸éæˆ‘ç°¡åŒ–äº†è§¸æ¨¡æ•£é–‹èˆ‡åŠ é€Ÿåº¦é€™å€‹éƒ¨åˆ†ï¼Œä¸»è¦æ˜¯ç·´ç¿’ swift å¯¦ä½œã€‚</p>
<p><a href="https://velog.io/@heekang/Vanilla-JS-%ED%8F%89%EC%B0%BD%EC%98%AC%EB%A6%BC%ED%94%BD-%EB%93%9C%EB%A1%A0%EC%87%BC-%EB%A7%8C%EB%93%A4%EA%B8%B0">[Vanilla JS] í‰ì°½ì˜¬ë¦¼í”½ ë“œë¡ ì‡¼ ë§Œë“¤ê¸°</a></p>
<p><strong>èªªæ˜ï¼š</strong></p>
<p>å¯¦ä½œçš„æ§‹æƒ³é‚„ç®—ç›´è¦ºï¼Œé™¤äº†<strong>é•·å£“é€£çºŒè§¸ç™¼</strong>éœ€è¦ç ”ç©¶ä¸€ä¸‹ã€‚</p>
<ol>
<li>ä½¿ç”¨ javascript çš„ <strong>canvas getImageData()</strong> å°‡ SVG å­˜æˆ json æª” (å¯åƒè€ƒä¸Šæ–‡é€£çµä¸­çš„ <strong>getDotPos</strong> æ–¹æ³•ã€‚</li>
<li>åœ¨ swift ä¸­ï¼Œé€éè®€å– json æª”ï¼Œå­˜æˆåº§æ¨™é»çš„é¡åˆ¥é™£åˆ—ï¼Œé€™å…©æ­¥é©Ÿä¹Ÿå¯ä»¥ç”¨ä¾†ç•«å…¶ä»–åœ–æ¡ˆï¼Œä¸ç”¨æ‰‹å·¥ä¸€ç›´æé»ã€‚</li>
</ol>


<div class="terminal space shadow">
    <div class="top">
        <div class="btns">
            <span class="circle red"></span>
            <span class="circle yellow"></span>
            <span class="circle green"></span>
        </div>
        <div class="title">
            load all points from json file
        </div>
    </div>
    <div class="terminalbody"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">import</span> <span class="nc">UIKit</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Point definition for json object</span>
</span></span><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">Point</span><span class="p">:</span> <span class="n">Decodable</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nv">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">Int</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nv">color</span><span class="p">:</span> <span class="nb">String</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// load all points from json file.</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ref: https://stackoverflow.com/a/50042872</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ref: https://praveenkommuri.medium.com/how-to-read-parse-local-json-file-in-swift-28f6cec747cf</span>
</span></span><span class="line"><span class="cl">  <span class="kd">static</span> <span class="kd">func</span> <span class="nf">loadFromJson</span><span class="p">(</span><span class="n">fileName</span> <span class="n">name</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="p">[</span><span class="n">Point</span><span class="p">]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">do</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">guard</span> <span class="kd">let</span> <span class="nv">filePath</span> <span class="p">=</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">path</span><span class="p">(</span><span class="n">forResource</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="n">ofType</span><span class="p">:</span> <span class="s">&#34;json&#34;</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">[]</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="kd">let</span> <span class="nv">fileUrl</span> <span class="p">=</span> <span class="n">URL</span><span class="p">(</span><span class="n">fileURLWithPath</span><span class="p">:</span> <span class="n">filePath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="kd">let</span> <span class="nv">data</span> <span class="p">=</span> <span class="k">try</span> <span class="n">Data</span><span class="p">(</span><span class="n">contentsOf</span><span class="p">:</span> <span class="n">fileUrl</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="kd">let</span> <span class="nv">points</span> <span class="p">=</span> <span class="k">try</span> <span class="n">JSONDecoder</span><span class="p">().</span><span class="n">decode</span><span class="p">([</span><span class="n">Point</span><span class="p">].</span><span class="kc">self</span><span class="p">,</span> <span class="n">from</span><span class="p">:</span> <span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">points</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// should not happen!</span>
</span></span><span class="line"><span class="cl">      <span class="bp">print</span><span class="p">(</span><span class="s">&#34;Something went wrong: </span><span class="si">\(</span><span class="n">error</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></div>
</div>
<br />

<ol start="3">
<li>è¨­è¨ˆ Drone é¡åˆ¥ï¼Œè®“ Drone <strong>åˆå§‹ä½ç½®</strong>æ˜¯éš¨æ©Ÿçš„ï¼Œ<strong>ç›®çš„ä½ç½®</strong>æ˜¯å‰›å‰›è¼‰å…¥çš„åœ–å½¢åº§æ¨™ã€‚</li>
<li>å°‡å…©åº§æ¨™åˆ†æˆ 20 ä»½ï¼ŒæŒçºŒæŒ‰å£“é€£çºŒè§¸ç™¼æ™‚ï¼Œä¸€æ¬¡ç§»å‹•ä¸€ä»½ã€‚</li>
<li>ç•¶åˆ°é”ç›®çš„åº§æ¨™æ™‚ï¼Œæ”¹è®Š Drone çš„é¡è‰²ã€‚</li>
</ol>


<div class="terminal space shadow">
    <div class="top">
        <div class="btns">
            <span class="circle red"></span>
            <span class="circle yellow"></span>
            <span class="circle green"></span>
        </div>
        <div class="title">
            handle long press event
        </div>
    </div>
    <div class="terminalbody"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">import</span> <span class="nc">UIKit</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">ViewController</span><span class="p">:</span> <span class="n">UIViewController</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nv">touchCountTimer</span><span class="p">:</span> <span class="n">Timer</span><span class="p">?</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nv">touchBeginTime</span><span class="p">:</span> <span class="nb">Double</span> <span class="p">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nv">droneCollection</span> <span class="p">=</span> <span class="n">DroneCollectionController</span><span class="p">(</span><span class="n">fromJsonFile</span><span class="p">:</span> <span class="s">&#34;ring&#34;</span><span class="p">)</span> <span class="c1">// composition</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kc">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">droneCollection</span><span class="p">.</span><span class="n">attachToLayer</span><span class="p">(</span><span class="n">to</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">layer</span><span class="p">)</span> <span class="c1">// attach drone layer</span>
</span></span><span class="line"><span class="cl">    <span class="n">addLongPressGesture</span><span class="p">()</span> <span class="c1">// handle press</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// register gesture recognizer</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ref: [How can i count time on long-pressed button using UILongPressGestureRecognizer](https://stackoverflow.com/a/53146530)</span>
</span></span><span class="line"><span class="cl">  <span class="kd">func</span> <span class="nf">addLongPressGesture</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nv">longPress</span> <span class="p">=</span> <span class="n">UILongPressGestureRecognizer</span><span class="p">(</span><span class="n">target</span><span class="p">:</span> <span class="kc">self</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="k">#selector</span><span class="p">(</span><span class="n">longPress</span><span class="p">(</span><span class="n">gesture</span><span class="p">:)))</span>
</span></span><span class="line"><span class="cl">    <span class="n">longPress</span><span class="p">.</span><span class="n">minimumPressDuration</span> <span class="p">=</span> <span class="mf">0.1</span>
</span></span><span class="line"><span class="cl">    <span class="n">longPress</span><span class="p">.</span><span class="n">numberOfTouchesRequired</span> <span class="p">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="kc">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">addGestureRecognizer</span><span class="p">(</span><span class="n">longPress</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// handle long press event</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ref: [How can i count time on long-pressed button using UILongPressGestureRecognizer](https://stackoverflow.com/a/53146530)</span>
</span></span><span class="line"><span class="cl">  <span class="kr">@objc</span> <span class="kd">func</span> <span class="nf">longPress</span><span class="p">(</span><span class="n">gesture</span><span class="p">:</span> <span class="n">UILongPressGestureRecognizer</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">switch</span> <span class="n">gesture</span><span class="p">.</span><span class="n">state</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="n">UIGestureRecognizer</span><span class="p">.</span><span class="n">State</span><span class="p">.</span><span class="n">began</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="n">touchCountTimer</span> <span class="p">=</span> <span class="n">Timer</span><span class="p">.</span><span class="n">scheduledTimer</span><span class="p">(</span><span class="n">withTimeInterval</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">repeats</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="n">block</span><span class="p">:</span> <span class="p">{</span> <span class="p">[</span><span class="kc">self</span><span class="p">]</span> <span class="p">(</span><span class="n">timer</span><span class="p">)</span> <span class="k">in</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// </span><span class="cs">MARK:</span><span class="c1"> - do animation</span>
</span></span><span class="line"><span class="cl">        <span class="n">droneCollection</span><span class="p">.</span><span class="n">animation</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">      <span class="n">touchBeginTime</span> <span class="p">=</span> <span class="n">Date</span><span class="p">().</span><span class="n">timeIntervalSince1970</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="p">.</span><span class="n">ended</span><span class="p">,</span> <span class="p">.</span><span class="n">failed</span><span class="p">,</span> <span class="p">.</span><span class="n">cancelled</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="n">touchCountTimer</span><span class="p">?.</span><span class="n">invalidate</span><span class="p">()</span> <span class="c1">// Stops the timer</span>
</span></span><span class="line"><span class="cl">      <span class="n">DroneCollectionController</span><span class="p">.</span><span class="n">isArrived</span> <span class="p">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="p">.</span><span class="n">changed</span><span class="p">:</span> <span class="c1">// wipe</span>
</span></span><span class="line"><span class="cl">      <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="k">default</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="bp">print</span><span class="p">(</span><span class="s">&#34;unknown&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></div>
</div>
<br />

]]></content:encoded>
    </item>
    <item>
      <title>iPadä¸Šçš„å½±ç‰‡æ’­æ”¾å™¨</title>
      <link>https://blog2.cmwang.net/zh/posts/2022/03/practice-avplayer-view-controller/</link>
      <pubDate>Wed, 16 Mar 2022 10:32:00 +0000</pubDate>
      <guid>https://blog2.cmwang.net/zh/posts/2022/03/practice-avplayer-view-controller/</guid>
      <description>ç·´ç¿’ä½¿ç”¨ AVPlayerViewController è£½ä½œå‹•æ…‹å­—å¹•å½±ç‰‡</description>
      <content:encoded><![CDATA[<p><strong>å­¸ç¿’ç›®æ¨™ï¼š</strong></p>
<ul>
<li>AVPlayer</li>
<li>NotificationCenter</li>
<li>Timer</li>
<li>Swift Optional</li>
<li>Function</li>
<li>Switch Case</li>
</ul>
<p><strong>ç·´ç¿’æˆæœï¼š</strong></p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube-nocookie.com/embed/qnXX_HtG1sw" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<p><strong>åŸå§‹ç¢¼ï¼š</strong></p>
<p><a href="https://github.com/takawang/letter-song">GitHub - takawang/letter-song</a></p>
<p><strong>æ­Œè©ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ä»Šæ™š æˆ‘æƒ³å°‡é‚£å¤©çš„è¢ç«
</span></span><span class="line"><span class="cl">é€åˆ°ä½ çš„çª—å‰
</span></span><span class="line"><span class="cl">å«æ„æ˜¯&#34;æˆ‘æ„›ä½ &#34;
</span></span><span class="line"><span class="cl">æˆ‘æƒ³èµ·æˆ‘å€‘çš„åˆå»
</span></span><span class="line"><span class="cl">ä¸ç®¡ä½•æ™‚ åªè¦é–‰ä¸Šé›™çœ¼
</span></span><span class="line"><span class="cl">å°±èƒ½å¥”å‘é‚£æœ€é™é çš„åœ°æ–¹
</span></span><span class="line"><span class="cl">å°±åƒæˆ‘åœ¨è¢«æµªæ¿¤æ¹§ä¾†çš„æ²™ä¸Šå¯«ä¸‹çš„å­—è·¡èˆ¬
</span></span><span class="line"><span class="cl">ä½ æ„Ÿè¦ºä¹Ÿæœƒåƒä»–å€‘é‚£æ¨£å¾æ­¤æ¶ˆå¤±
</span></span><span class="line"><span class="cl">ç¸½æ˜¯æƒ³å¿µ
</span></span><span class="line"><span class="cl">é›–ç„¶ç„¡æ³•å°‡æˆ‘å¿ƒè£¡æ‰€æœ‰çš„è©±èªï¼Œèªªçµ¦ä½ è½
</span></span><span class="line"><span class="cl">ä½†é‚£è£¡é ­ï¼Œå…¨éƒ½æ˜¯&#34;æˆ‘æ„›ä½ &#34;
</span></span><span class="line"><span class="cl">æˆ‘ä½•å¾·ä½•èƒ½
</span></span><span class="line"><span class="cl">èƒ½æ“æœ‰åç‚ºä½ çš„é€™ä»½å¹¸é‹
</span></span><span class="line"><span class="cl">è‹¥æˆ‘å€‘ç¾åœ¨èƒ½æœ›è‘—å°æ–¹
</span></span><span class="line"><span class="cl">è©²æœ‰å¤šç¾å¥½
</span></span><span class="line"><span class="cl">å°±åƒæˆ‘åœ¨è¢«æµªæ¿¤æ¹§ä¾†çš„æ²™ä¸Šå¯«ä¸‹çš„å­—è·¡èˆ¬
</span></span><span class="line"><span class="cl">ä½ æ„Ÿè¦ºä¹Ÿæœƒåƒä»–å€‘é‚£æ¨£å¾æ­¤æ¶ˆå¤±
</span></span><span class="line"><span class="cl">é‚„æ˜¯æƒ³å¿µ
</span></span><span class="line"><span class="cl">é›–ç„¶ç„¡æ³•å°‡æˆ‘å¯«åœ¨æ—¥è¨˜ä¸Šçš„ä¸€å­—ä¸€å¥
</span></span><span class="line"><span class="cl">éƒ½å‘Šè¨´ä½ 
</span></span><span class="line"><span class="cl">ä½†å­—å­—å¥å¥éƒ½ä»£è¡¨è‘—æˆ‘æ„›ä½ 
</span></span><span class="line"><span class="cl">ä»Šæ™š æˆ‘æƒ³å°‡é‚£å¤©çš„è¢ç«
</span></span><span class="line"><span class="cl">é€åˆ°ä½ çš„çª—å‰
</span></span><span class="line"><span class="cl">å¸Œæœ›ä»Šå¤œçš„ä½ æœ‰å€‹ç¾å¥½çš„å¤¢
</span></span></code></pre></div><p><strong>å½±ç‰‡ä¾†æºï¼š</strong><a href="https://www.youtube.com/watch?v=BzYnNdJhZQw">https://www.youtube.com/watch?v=BzYnNdJhZQw</a></p>
<p><strong>æ­Œè©ä¾†æºï¼š</strong><a href="https://tinyurl.com/2p9c5d8a">https://tinyurl.com/2p9c5d8a</a></p>
<p><strong>Storyboard:</strong></p>
<p><img loading="lazy" src="images/1.png" alt="image"  />
</p>
<hr>
<p><strong>éç¨‹ï¼š</strong></p>
<p>æœ¬æ¬¡çµåˆå¹¾å€‹é …ç›®ï¼Œç·´ç¿’ SDK ä½¿ç”¨èˆ‡ç†Ÿæ‚‰ Swift èªæ³•ï¼Œåªç”¨ function print ç„¡æ³•æ»¿è¶³è‡ªå·±çš„æœŸå¾…ï¼Œæ‰€ä»¥ä¸Šç¶²æŸ¥äº†ä¸€äº›è³‡æ–™ä¸¦æ­é…ä¸Šèª²å…§å®¹è£½ä½œï¼Œå°‡ AVPlayerViewController åŠ é€² UIView æ‡‰è©²æ˜¯æœ€å›°é›£çš„éƒ¨åˆ†ï¼ŒåŸæœ¬è€ƒæ…®ä½¿ç”¨ Container View å»åšï¼Œä½†é‚„ä¸çŸ¥é“æ€éº¼æ§åˆ¶å¤šå€‹ Controllerï¼Œä¸¦ä¸”è·Ÿ Storyboard ä¸²æ¥èµ·ä¾†ã€‚</p>
<p>ä¸»è¦åœ¨ <strong>iPad Pro 12.9</strong> èˆ‡ <strong>iPad Mini 6</strong> å¯¦æ©Ÿæ¸¬è©¦éï¼ŒiPhone ç‰ˆé¢æœƒçœ‹ä¸åˆ°æ­Œè©ã€‚</p>
<ol>
<li>æ–°å¢ UIViewï¼Œå–å¾— IBOutlet -&gt; Line 12</li>
<li>å°‡ AVPlayerViewController åŠ é€² UIView -&gt; Line 50</li>
<li>ç”¨ IBAction æ§åˆ¶ å½±ç‰‡æ’­æ”¾ä¸¦é–‹å§‹è¨ˆæ™‚ -&gt; Line59</li>
<li>è¨»å†Š View ç”Ÿå‘½é€±æœŸèˆ‡å½±ç‰‡æ’­æ”¾çµæŸçš„é€šçŸ¥ -&gt; Line 20~28</li>
</ol>


<div class="terminal space shadow">
    <div class="top">
        <div class="btns">
            <span class="circle red"></span>
            <span class="circle yellow"></span>
            <span class="circle green"></span>
        </div>
        <div class="title">
            Partial script
        </div>
    </div>
    <div class="terminalbody"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">import</span> <span class="nc">AVFoundation</span>
</span></span><span class="line"><span class="cl"><span class="kd">import</span> <span class="nc">AVKit</span>
</span></span><span class="line"><span class="cl"><span class="kd">import</span> <span class="nc">UIKit</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">ViewController</span><span class="p">:</span> <span class="n">UIViewController</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">@IBOutlet</span> <span class="kr">weak</span> <span class="kd">var</span> <span class="nv">lyricsLabel</span><span class="p">:</span> <span class="n">UILabel</span><span class="p">!</span>
</span></span><span class="line"><span class="cl">  <span class="kr">@IBOutlet</span> <span class="kr">weak</span> <span class="kd">var</span> <span class="nv">videoView</span><span class="p">:</span> <span class="n">UIView</span><span class="p">!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nv">player</span><span class="p">:</span> <span class="n">AVPlayer</span><span class="p">?</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nv">timer</span><span class="p">:</span> <span class="n">Timer</span><span class="p">?</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nv">counter</span> <span class="p">=</span> <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nv">isPlaying</span> <span class="p">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kc">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// listen to active and resign notifications</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ref: https://stackoverflow.com/a/45955660</span>
</span></span><span class="line"><span class="cl">    <span class="n">NotificationCenter</span><span class="p">.</span><span class="k">default</span><span class="p">.</span><span class="n">addObserver</span><span class="p">(</span><span class="kc">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="k">#selector</span><span class="p">(</span><span class="kc">self</span><span class="p">.</span><span class="n">openAndCloseActivity</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                                           <span class="n">name</span><span class="p">:</span> <span class="n">UIApplication</span><span class="p">.</span><span class="n">didBecomeActiveNotification</span><span class="p">,</span> <span class="n">object</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">NotificationCenter</span><span class="p">.</span><span class="k">default</span><span class="p">.</span><span class="n">addObserver</span><span class="p">(</span><span class="kc">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="k">#selector</span><span class="p">(</span><span class="kc">self</span><span class="p">.</span><span class="n">openAndCloseActivity</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                                           <span class="n">name</span><span class="p">:</span> <span class="n">UIApplication</span><span class="p">.</span><span class="n">willResignActiveNotification</span><span class="p">,</span> <span class="n">object</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// listen to end play notification</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ref: https://www.tutorialspoint.com/how-to-use-swift-to-detect-when-avplayer-video-ends-playing</span>
</span></span><span class="line"><span class="cl">    <span class="n">NotificationCenter</span><span class="p">.</span><span class="k">default</span><span class="p">.</span><span class="n">addObserver</span><span class="p">(</span><span class="kc">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="k">#selector</span><span class="p">(</span><span class="kc">self</span><span class="p">.</span><span class="n">videoDidEnd</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                                           <span class="n">name</span><span class="p">:</span> <span class="n">NSNotification</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">AVPlayerItemDidPlayToEndTime</span><span class="p">,</span> <span class="n">object</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// setup avplayer controller</span>
</span></span><span class="line"><span class="cl">    <span class="n">initVideoView</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// setup avplayer controller</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// add avplayer controller to the current view and hide playback controls</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kd">func</span> <span class="nf">initVideoView</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ref: https://medium.com/@nabilsafatli/how-to-create-a-custom-control-for-avplayer-1e53b9188ae3</span>
</span></span><span class="line"><span class="cl">    <span class="k">guard</span> <span class="kd">let</span> <span class="nv">url</span> <span class="p">=</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">url</span><span class="p">(</span><span class="n">forResource</span><span class="p">:</span> <span class="s">&#34;night&#34;</span><span class="p">,</span> <span class="n">withExtension</span><span class="p">:</span> <span class="s">&#34;mp4&#34;</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kc">self</span><span class="p">.</span><span class="n">player</span> <span class="p">=</span> <span class="n">AVPlayer</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//player!.rate = 1 //auto play</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nv">playerFrame</span> <span class="p">=</span> <span class="n">CGRect</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="n">videoView</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="n">videoView</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">height</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nv">playerViewController</span> <span class="p">=</span> <span class="n">AVPlayerViewController</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">playerViewController</span><span class="p">.</span><span class="n">player</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">player</span>
</span></span><span class="line"><span class="cl">    <span class="n">playerViewController</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">frame</span> <span class="p">=</span> <span class="n">playerFrame</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">addChild</span><span class="p">(</span><span class="n">playerViewController</span><span class="p">)</span> <span class="c1">// add player controller to view controller</span>
</span></span><span class="line"><span class="cl">    <span class="n">videoView</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">playerViewController</span><span class="p">.</span><span class="n">view</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">playerViewController</span><span class="p">.</span><span class="n">didMove</span><span class="p">(</span><span class="n">toParent</span><span class="p">:</span> <span class="kc">self</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">playerViewController</span><span class="p">.</span><span class="n">showsPlaybackControls</span> <span class="p">=</span> <span class="kc">false</span> <span class="c1">// hide playback controls</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// handle play click event</span>
</span></span><span class="line"><span class="cl">  <span class="kr">@IBAction</span> <span class="kd">func</span> <span class="nf">playVideo</span><span class="p">(</span><span class="kc">_</span> <span class="n">sender</span><span class="p">:</span> <span class="n">UIButton</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">!</span><span class="kc">self</span><span class="p">.</span><span class="n">isPlaying</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">isPlaying</span> <span class="p">=</span> <span class="kc">true</span> <span class="c1">// set flag</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">counter</span> <span class="p">=</span> <span class="mf">0.0</span> <span class="c1">// init counter</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">player</span><span class="p">?.</span><span class="n">seek</span><span class="p">(</span><span class="n">to</span><span class="p">:</span> <span class="n">CMTime</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">CMTimeValue</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span> <span class="n">timescale</span><span class="p">:</span> <span class="mi">1000</span><span class="p">))</span> <span class="c1">// seek to head</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1">// init timer.</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// ref: https://medium.com/å½¼å¾—æ½˜çš„-swift-ios-app-é–‹ç™¼æ•™å®¤/é€é-timer-è¨­å®šæ¯å¹¾ç§’é‡è¤‡åŸ·è¡Œ-function-3c80f449107</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">timer</span> <span class="p">=</span> <span class="n">Timer</span><span class="p">.</span><span class="n">scheduledTimer</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">timeInterval</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">target</span><span class="p">:</span> <span class="kc">self</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">selector</span><span class="p">:</span> <span class="k">#selector</span><span class="p">(</span><span class="n">updateLyrics</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">userInfo</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">repeats</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1">// play video</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">player</span><span class="p">?.</span><span class="n">play</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="bp">print</span><span class="p">(</span><span class="s">&#34;already playing, do nothing...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">@objc</span> <span class="kd">func</span> <span class="nf">updateLyrics</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kc">self</span><span class="p">.</span><span class="n">counter</span> <span class="o">+=</span> <span class="mf">0.1</span> <span class="c1">// increase counter</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">switch</span> <span class="kc">self</span><span class="p">.</span><span class="n">counter</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mf">5.0</span><span class="p">...</span><span class="mf">20.0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;IU - å¤œä¿¡&#34;</span> <span class="c1">// 0</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mf">24.4</span><span class="p">...</span><span class="mf">37.4</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;ä»Šæ™š  æˆ‘æƒ³å°‡é‚£å¤©çš„è¢ç«&#34;</span> <span class="c1">// 1</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mf">37.5</span><span class="p">...</span><span class="mf">47.0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;é€åˆ°ä½ çš„çª—å‰&#34;</span> <span class="c1">// 2</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mf">49.6</span><span class="p">...</span><span class="mf">59.0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;å«æ„æ˜¯ </span><span class="se">\&#34;</span><span class="s">æˆ‘æ„›ä½ </span><span class="se">\&#34;</span><span class="s">&#34;</span> <span class="c1">// 3</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mf">68.8</span><span class="p">...</span><span class="mf">80.8</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;æˆ‘æƒ³èµ·æˆ‘å€‘çš„åˆå»&#34;</span> <span class="c1">// 4</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mf">80.9</span><span class="p">...</span><span class="mf">90.0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;ä¸ç®¡ä½•æ™‚ åªè¦é–‰ä¸Šé›™çœ¼&#34;</span> <span class="c1">// 5</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mf">93.1</span><span class="p">...</span><span class="mf">103.2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;å°±èƒ½å¥”å‘é‚£æœ€é™é çš„åœ°æ–¹&#34;</span> <span class="c1">// 6</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mf">105.7</span><span class="p">...</span><span class="mf">115.8</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;å°±åƒæˆ‘åœ¨è¢«æµªæ¿¤æ¹§ä¾†çš„æ²™ä¸Šå¯«ä¸‹çš„å­—è·¡èˆ¬&#34;</span> <span class="c1">// 7,8</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mf">115.9</span><span class="p">...</span><span class="mf">123.4</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;ä½ æ„Ÿè¦ºä¹Ÿæœƒåƒä»–å€‘é‚£æ¨£å¾æ­¤æ¶ˆå¤±&#34;</span> <span class="c1">// 9</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mf">123.5</span><span class="p">...</span><span class="mf">127.4</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;ç¸½æ˜¯æƒ³å¿µ&#34;</span> <span class="c1">// 10</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mf">127.5</span><span class="p">...</span><span class="mf">141.0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;é›–ç„¶ç„¡æ³•å°‡æˆ‘å¿ƒè£¡æ‰€æœ‰çš„è©±èª  èªªçµ¦ä½ è½&#34;</span> <span class="c1">// 11,12</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mf">141.2</span><span class="p">...</span><span class="mf">151.3</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;ä½†é‚£è£¡é ­å…¨éƒ½æ˜¯ </span><span class="se">\&#34;</span><span class="s">æˆ‘æ„›ä½ </span><span class="se">\&#34;</span><span class="s">&#34;</span> <span class="c1">// 13</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mf">160.1</span><span class="p">...</span><span class="mf">166.0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;æˆ‘ä½•å¾·ä½•èƒ½&#34;</span> <span class="c1">// 14</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mf">166.1</span><span class="p">...</span><span class="mf">171.7</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;èƒ½æ“æœ‰åç‚ºä½ çš„é€™ä»½å¹¸é‹&#34;</span> <span class="c1">// 15</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mf">171.8</span><span class="p">...</span><span class="mf">176.8</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;è‹¥æˆ‘å€‘ç¾åœ¨èƒ½æœ›è‘—å°æ–¹&#34;</span> <span class="c1">// 16</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mf">176.9</span><span class="p">...</span><span class="mf">184.0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;è©²æœ‰å¤šç¾å¥½&#34;</span> <span class="c1">// 17</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mf">184.1</span><span class="p">...</span><span class="mf">194.1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;å°±åƒæˆ‘åœ¨è¢«æµªæ¿¤æ¹§ä¾†çš„æ²™ä¸Šå¯«ä¸‹çš„å­—è·¡èˆ¬&#34;</span> <span class="c1">// 18,19</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mf">194.2</span><span class="p">...</span><span class="mf">202.5</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;ä½ æ„Ÿè¦ºä¹Ÿæœƒåƒä»–å€‘é‚£æ¨£å¾æ­¤æ¶ˆå¤±&#34;</span> <span class="c1">// 20</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mf">202.6</span><span class="p">...</span><span class="mf">205.8</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;é‚„æ˜¯æƒ³å¿µ&#34;</span> <span class="c1">// 21</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mf">205.9</span><span class="p">...</span><span class="mf">212.1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;é›–ç„¶ç„¡æ³•å°‡æˆ‘å¯«åœ¨æ—¥è¨˜ä¸Šçš„ä¸€å­—ä¸€å¥&#34;</span> <span class="c1">// 22</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mf">212.2</span><span class="p">...</span><span class="mf">220.5</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;éƒ½å‘Šè¨´ä½ &#34;</span> <span class="c1">// 23</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mf">220.6</span><span class="p">...</span><span class="mf">226.4</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;ä½†å­—å­—å¥å¥éƒ½ä»£è¡¨è‘—æˆ‘æ„›ä½ &#34;</span> <span class="c1">// 24</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mf">228.5</span><span class="p">...</span><span class="mf">241.9</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;ä»Šæ™š  æˆ‘æƒ³å°‡é‚£å¤©çš„è¢ç«&#34;</span> <span class="c1">// 25</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mf">242.0</span><span class="p">...</span><span class="mf">249.7</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;é€åˆ°ä½ çš„çª—å‰&#34;</span> <span class="c1">// 26</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="mf">255.9</span><span class="p">...</span><span class="mf">267.2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;å¸Œæœ›ä»Šå¤œçš„ä½ æœ‰å€‹ç¾å¥½çš„å¤¢&#34;</span> <span class="c1">// 27</span>
</span></span><span class="line"><span class="cl">    <span class="k">default</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// handle vidie end notification</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ref: https://www.tutorialspoint.com/how-to-use-swift-to-detect-when-avplayer-video-ends-playing</span>
</span></span><span class="line"><span class="cl">  <span class="kr">@objc</span> <span class="kd">func</span> <span class="nf">videoDidEnd</span><span class="p">(</span><span class="n">notification</span><span class="p">:</span> <span class="n">NSNotification</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="bp">print</span><span class="p">(</span><span class="s">&#34;video ended&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kc">self</span><span class="p">.</span><span class="n">timer</span><span class="p">?.</span><span class="n">invalidate</span><span class="p">()</span> <span class="c1">// stop timer</span>
</span></span><span class="line"><span class="cl">    <span class="kc">self</span><span class="p">.</span><span class="n">isPlaying</span> <span class="p">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">    <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// handle activity resume and close</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ref: https://stackoverflow.com/a/45955660</span>
</span></span><span class="line"><span class="cl">  <span class="kr">@objc</span> <span class="kd">func</span> <span class="nf">openAndCloseActivity</span><span class="p">(</span><span class="kc">_</span> <span class="n">notification</span><span class="p">:</span> <span class="n">Notification</span><span class="p">)</span>  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">notification</span><span class="p">.</span><span class="n">name</span> <span class="p">==</span> <span class="n">UIApplication</span><span class="p">.</span><span class="n">didBecomeActiveNotification</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="bp">print</span><span class="p">(</span><span class="s">&#34;resume activity&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1">// seek to head</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">player</span><span class="p">?.</span><span class="n">seek</span><span class="p">(</span><span class="n">to</span><span class="p">:</span> <span class="n">CMTime</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">CMTimeValue</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span> <span class="n">timescale</span><span class="p">:</span> <span class="mi">1000</span><span class="p">))</span> <span class="c1">// ref: https://stackoverflow.com/a/59839041</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="bp">print</span><span class="p">(</span><span class="s">&#34;close activity&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">player</span><span class="p">?.</span><span class="n">pause</span><span class="p">()</span> <span class="c1">// pause player</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">timer</span><span class="p">?.</span><span class="n">invalidate</span><span class="p">()</span> <span class="c1">// stop timer</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">isPlaying</span> <span class="p">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">      <span class="kc">self</span><span class="p">.</span><span class="n">lyricsLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></div>
</div>
<br />

<p><strong>å…è²¬è²æ˜ï¼š</strong></p>
<p>å½±ç‰‡ä½¿ç”¨åªç‚ºäº†å­¸ç¿’ç›®çš„ï¼Œæ²’æœ‰ç‡Ÿåˆ©è¡Œç‚ºï¼Œç‰ˆæ¬Šå±¬æ–¼åŸå‰µä½œæ–¹ <a href="https://www.youtube.com/channel/UCweOkPb1wVVH0Q0Tlj4a5Pw">1theK</a>.</p>
]]></content:encoded>
    </item>
    <item>
      <title>ä»¿è£½ iPad ä¸Šçš„ Apple Music</title>
      <link>https://blog2.cmwang.net/zh/posts/2022/03/replicate-apple-music-ipad-os-app/</link>
      <pubDate>Sun, 13 Mar 2022 11:35:11 +0000</pubDate>
      <guid>https://blog2.cmwang.net/zh/posts/2022/03/replicate-apple-music-ipad-os-app/</guid>
      <description>ç·´ç¿’ä½¿ç”¨ Scroll View &amp;amp; Table View ä»¿è£½ iPad ä¸Šçš„ Apple Music App</description>
      <content:encoded><![CDATA[<p><strong>å­¸ç¿’ç›®æ¨™ï¼š</strong></p>
<ul>
<li>ç·´ç¿’ Scroll View</li>
<li>ç·´ç¿’ Navigation Controller</li>
<li>ç·´ç¿’ Table View Controller &amp; Static Cells</li>
<li>ç·´ç¿’ Label &amp; Button æ¨£å¼</li>
<li>ç·´ç¿’ segue &amp; SF Symbols</li>
</ul>
<p><strong>ç·´ç¿’æˆæœï¼š</strong></p>
<p><img loading="lazy" src="images/1.gif" alt="ç·´ç¿’æˆæœéŒ„å½±æˆªåœ–"  />
</p>
<p><a href="https://github.com/takawang/fake-music">GitHub - takawang/fake-music</a></p>
<p><strong>éç¨‹ï¼š</strong></p>
<p>é€éç›´æ¥æ“·å– iPad Pro 12.9 å¯¦æ©Ÿç•«é¢ï¼Œåœ¨ story board ä¸Šä»¿è£½ Apple Music ä¸Šçš„ IU å°ˆè¼¯é é¢ï¼Œæ›´é€²ä¸€æ­¥ç†Ÿæ‚‰äº† Navigation Controller çš„ä½¿ç”¨ï¼Œå› ç‚ºé‚„ä¸æœƒè£½ä½œç¬¦åˆå„ç¨®æ©Ÿå‹çš„ç‰ˆé¢ï¼Œæ‰€ä»¥å°±ç›´æ¥ hardcode åªæ”¯æ´ 12.9 æ°´å¹³çš„ç‰ˆé¢ï¼Œæ˜¯æœ‰é»å‘†ç‰ˆä½†ä¹Ÿæ”¶ç©«ä¸å°‘ã€‚</p>
<p><img loading="lazy" src="images/2.png" alt="image"  />

é™å®šåªæ”¯æ´ iPad èˆ‡ Landscape</p>
<p><img loading="lazy" src="images/3.png" alt="image"  />

ä¿®æ”¹ Product Name æ”¹è®Š APP åœ¨æ¡Œé¢çš„åç¨±</p>
<p>éœ€è¦æ³¨æ„çš„åœ°æ–¹æ˜¯ï¼Œåœ¨ story board ä¸Šçš„æ˜¯ pointï¼Œä½†è¢å¹•æˆªåœ–æ˜¯ pixelï¼Œå› ç‚ºæ²’æœ‰ zeplin ä¹‹é¡çš„è¨­è¨ˆç¨¿ï¼Œæ‰€ä»¥èŠ±æœ€å¤šæ™‚é–“é‚„æ˜¯åœ¨æŠ“å–èˆ‡å°é½Šåº§æ¨™ï¼Œä½ç½®ä¸æ˜¯ pixel perfectï¼Œä½†ç·´ç¿’çš„ç›®çš„æ‡‰è©²æ˜¯é”åˆ°äº†ã€‚</p>
<p><img loading="lazy" src="images/4.png" alt="image"  />

Point èˆ‡ pixel æ˜¯ 2x scale çš„é—œä¿‚</p>
<p><strong>æœ€è¿‘æ’­æ”¾</strong>çš„é»é¸ï¼Œåƒè€ƒä¸‹é¢æ–‡ç« ï¼ŒåŸæœ¬ä½¿ç”¨ <strong>tap gesture recognizer</strong>ï¼Œä¸éå¤§æ¦‚å› ç‚ºæˆ‘å°‡ navigation controller æ”¾éŒ¯åœ°æ–¹ï¼Œç¸½æ˜¯çœ‹ä¸åˆ° back é¸å–®ï¼Œæœ€å¾Œé¸æ“‡<strong>é€æ˜æŒ‰éˆ•ç–Šåœ¨ä¸Šæ–¹</strong>çš„åšæ³•ã€‚</p>
<p><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-segue-%E5%AF%A6%E7%8F%BE%E5%9C%96%E7%89%87%E9%BB%9E%E9%81%B8%E7%9A%84%E6%8F%9B%E9%A0%81%E5%8A%9F%E8%83%BD-84f6991d74d4">åˆ©ç”¨ segue å¯¦ç¾åœ–ç‰‡é»é¸çš„æ›é åŠŸèƒ½</a></p>
<p><img loading="lazy" src="images/5.png" alt="image"  />

Navigation Controller éœ€è¦å¾ç¬¬ä¸€å€‹ç•«é¢é•·å‡ºä¾†ï¼Œè€Œä¸æ˜¯ç¬¬äºŒé </p>
<p>ä¸»ç•«é¢æœ‰å…©å€‹ scoll viewï¼Œåƒè€ƒé€£çµæä¾›çš„æŠ€å·§å°±å¯ä»¥æ–¹ä¾¿è£½ä½œï¼Œè¨˜å¾—å°‡<strong>æ°´å¹³èˆ‡å‚ç›´çš„æ²è»¸æŒ‡ç¤º</strong>é—œé–‰ï¼Œé€™æ¨£ç•«é¢æœƒæ¯”è¼ƒæ“¬çœŸã€‚</p>
<p><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%9C%A8-storyboard-%E8%A8%AD%E5%AE%9A-content-size-%E5%AF%A6%E7%8F%BE%E6%B0%B4%E5%B9%B3%E6%8D%B2%E5%8B%95%E7%9A%84-scroll-view-2710fa247293">è¨­å®š content sizeï¼Œå¯¦ç¾æ°´å¹³æ²å‹•ï¼Œä¸Šä¸‹æ²å‹•å’Œåˆ†é çš„ scroll view</a></p>
<p><img loading="lazy" src="images/6.png" alt="image"  />

å–æ¶ˆå‹¾é¸æ°´å¹³èˆ‡å‚ç›´ indicatorï¼Œä½¿å¾— scroll view æ²å‹•æ™‚ä¸æœƒé¡¯ç¤ºå·è»¸</p>
<p>Table View çš„ç¬¬ä¸€å€‹ Cell èˆ‡æœ€å¾Œå…©å€‹ Cell ç‚ºäº†ç‰ˆé¢èª¿æ•´ï¼Œä¸­é–“çš„æ­Œæ›²åˆ—è¡¨åªéœ€è¦é€éä¿®æ”¹ row æ•¸å°±å¯ä»¥è¤‡è£½ï¼Œå†ä¿®æ”¹å°é¢ç…§èˆ‡ label å³å¯ã€‚</p>
]]></content:encoded>
    </item>
  </channel>
</rss>
